{
  "estimated_tokens": 0,
  "project_tree": "",
  "files": {
    "internal/builder/builder.go": "package builder\n\nimport (\n\t\"bufio\"\n\t\"fmt\"\n\t\"goctx/internal/model\"\n\t\"os\"\n\t\"path/filepath\"\n\t\"strings\"\n\t\"sync\"\n)\n\nconst AI_PROMPT_HEADER = `You are an AI developer agent. Return ONLY JSON:\n{\n  \"short_description\": \"summary\",\n  \"files\": { \"path\": \"content\" }\n}`\n\nfunc BuildContext(root string) (model.ProjectOutput, error) {\n\treturn BuildSelectiveContext(root, nil)\n}\n\nfunc LoadIgnorePatterns(root string) []string {\n\tpatterns := []string{\".git\", \".stashes\", \"node_modules\", \"goctx\", \"go.sum\"}\n\tf, err := os.Open(filepath.Join(root, \".ctxignore\"))\n\tif err == nil {\n\t\tdefer f.Close()\n\t\tscanner := bufio.NewScanner(f)\n\t\tfor scanner.Scan() {\n\t\t\tline := strings.TrimSpace(scanner.Text())\n\t\t\tif line != \"\" \u0026\u0026 !strings.HasPrefix(line, \"#\") {\n\t\t\t\tpatterns = append(patterns, line)\n\t\t\t}\n\t\t}\n\t}\n\treturn patterns\n}\n\nfunc BuildSelectiveContext(root string, targets []string) (model.ProjectOutput, error) {\n\tout := model.ProjectOutput{\n\t\tInstructionHeader: AI_PROMPT_HEADER,\n\t\tShortDescription:  \"Workspace snapshot\",\n\t\tFiles:             make(map[string]string),\n\t}\n\n\tignorePatterns := LoadIgnorePatterns(root)\n\tfileChan := make(chan string, 100)\n\tresultChan := make(chan struct{p string; c string}, 100)\n\tvar wg sync.WaitGroup\n\n\tfor i := 0; i \u003c 8; i++ {\n\t\twg.Add(1)\n\t\tgo func() {\n\t\t\tdefer wg.Done()\n\t\t\tfor path := range fileChan {\n\t\t\t\tc, err := os.ReadFile(path)\n\t\t\t\tif err == nil {\n\t\t\t\t\trel, _ := filepath.Rel(root, path)\n\t\t\t\t\tresultChan \u003c- struct{p string; c string}{rel, string(c)}\n\t\t\t\t}\n\t\t\t}\n\t\t}()\n\t}\n\n\tdone := make(chan bool)\n\tvar totalChars int\n\tgo func() {\n\t\tfor res := range resultChan {\n\t\t\tout.Files[res.p] = res.c\n\t\t\ttotalChars += len(res.c)\n\t\t}\n\t\tdone \u003c- true\n\t}()\n\n\tvar tree strings.Builder\n\terr := filepath.Walk(root, func(path string, info os.FileInfo, err error) error {\n\t\tif err != nil || path == root { return nil }\n\t\trel, _ := filepath.Rel(root, path)\n\t\tfor _, p := range ignorePatterns {\n\t\t\tif strings.Contains(rel, p) {\n\t\t\t\tif info.IsDir() { return filepath.SkipDir }\n\t\t\t\treturn nil\n\t\t\t}\n\t\t}\n\t\tdepth := strings.Count(rel, string(os.PathSeparator))\n\t\tindent := \"\"\n\t\tif depth \u003e 0 { indent = strings.Repeat(\"  \", depth) + \"└── \" }\n\t\ttree.WriteString(fmt.Sprintf(\"%s%s\\n\", indent, info.Name()))\n\t\tif !info.IsDir() { fileChan \u003c- path }\n\t\treturn nil\n\t})\n\n\tclose(fileChan); wg.Wait(); close(resultChan); \u003c-done\n\tout.ProjectTree = tree.String()\n\tout.EstimatedTokens = (totalChars + len(out.ProjectTree)) / 4\n\treturn out, err\n}\n",
    "internal/builder/context.go": "",
    "internal/stash/stash.go": "package stash\n\nimport (\n\t\"encoding/json\"\n\t\"os\"\n\t\"path/filepath\"\n\t\"time\"\n\n\t\"goctx/internal/model\"\n)\n\nfunc CreateStash(root string, patch model.ProjectOutput) (string, error) {\n\tid := time.Now().Format(\"20060102_150405\")\n\tbase := filepath.Join(root, \".stashes\", id)\n\n\tos.MkdirAll(filepath.Join(base, \"backup\"), 0755)\n\n\trootAbs, _ := filepath.Abs(root)\n\n\tfor relPath := range patch.Files {\n\t\ttarget := filepath.Join(rootAbs, relPath)\n\t\tif _, err := os.Stat(target); err == nil {\n\t\t\tdata, _ := os.ReadFile(target)\n\t\t\tbpath := filepath.Join(base, \"backup\", relPath)\n\t\t\tos.MkdirAll(filepath.Dir(bpath), 0755)\n\t\t\tos.WriteFile(bpath, data, 0644)\n\t\t}\n\t}\n\n\tpatchData, _ := json.MarshalIndent(patch, \"\", \"  \")\n\tos.WriteFile(filepath.Join(base, \"patch.json\"), patchData, 0644)\n\n\treturn id, nil\n}\n",
    "internal/ui/actions.go": "package ui\n\nimport (\n\t\"encoding/json\"\n\t\"strings\"\n\t\"time\"\n\n\t\"goctx/internal/model\"\n\n\t\"github.com/gotk3/gotk3/gdk\"\n\t\"github.com/gotk3/gotk3/gtk\"\n)\n\nfunc (a *App) startClipboardWatcher() {\n\tticker := time.NewTicker(1 * time.Second)\n\tvar last string\n\n\tgo func() {\n\t\tfor range ticker.C {\n\t\t\tclip, err := gtk.ClipboardGet(gdk.SELECTION_CLIPBOARD)\n\t\t\tif err != nil { continue }\n\n\t\t\ttext, err := clip.WaitForText()\n\t\t\tif err != nil || text == \"\" { continue }\n\t\t\tif text == last { continue }\n\t\t\tif !strings.Contains(text, \"{\\\"\") { continue }\n\n\t\t\tvar patch model.ProjectOutput\n\t\t\tif err := json.Unmarshal([]byte(text), \u0026patch); err != nil { continue }\n\t\t\tif len(patch.Files) == 0 { continue }\n\n\t\t\ta.mu.Lock()\n\t\t\ta.pendingPatches = append(a.pendingPatches, patch)\n\t\t\ta.mu.Unlock()\n\n\t\t\tlast = text\n\t\t}\n\t}()\n}\n",
    "internal/ui/render.go": "package ui\n\nimport (\n\t\"github.com/gotk3/gotk3/gdk\"\n\t\"github.com/gotk3/gotk3/gtk\"\n)\n\nfunc (a *App) setupDiffPane(textView *gtk.TextView) {\n\ttextView.SetEditable(false)\n\ttextView.SetCursorVisible(false)\n\n\ttextView.Connect(\"button-press-event\", func(tv *gtk.TextView, ev *gdk.Event) bool {\n\t\ta.mu.Lock()\n\t\ta.selectedIndex = -1\n\t\ta.mu.Unlock()\n\n\t\tbuffer, _ := tv.GetBuffer()\n\t\tbuffer.SelectRange(buffer.GetStartIter(), buffer.GetStartIter())\n\n\t\treturn false\n\t})\n}\n"
  }
}