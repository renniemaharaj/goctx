{
  "estimated_tokens": 7500,
  "project_tree": ".\ninternal\n  └── browser\n    └── automation.go\n  └── ui\n    └── ui.go\nassets\n  └── style.css\n",
  "files": {
    "internal/browser/automation.go": "package browser\n\nimport (\n\t\"context\"\n\t\"encoding/json\"\n\t\"errors\"\n\t\"goctx/internal/model\"\n\t\"regexp\"\n\t\"time\"\n\n\t\"github.com/go-rod/rod\"\n)\n\ntype AIWorker struct {\n\tBrowser *rod.Browser\n}\n\nfunc NewAIWorker() *AIWorker {\n\treturn \u0026AIWorker{Browser: rod.New().MustConnect()}\n}\n\nfunc (w *AIWorker) FetchAIUpdate(prompt string) (model.ProjectOutput, error) {\n\tpage := w.Browser.MustPage(\"https://google.com\") // Placeholder for specific AI URL\n\t\n\t// Logic to inject prompt into textarea and wait for response\n\t// This is a template for the scraping logic:\n\t\n\t// 1. Find textarea: page.MustElement(\"textarea\").MustInput(prompt).MustType(input.Enter)\n\t// 2. Wait for code blocks: page.MustWaitIdle()\n\t\n\t// For now, we simulate the scraping result of the page content:\n\tpageContent := \"{...}\" // page.MustElement(\"body\").MustText()\n\t\n\treturn ExtractProjectState(pageContent)\n}\n\nfunc ExtractProjectState(input string) (model.ProjectOutput, error) {\n\tre := regexp.MustCompile(`(?s)\\{.*\\\"project_tree\\\".*\\\"files\\\".*\\}`) \n\tmatch := re.FindString(input)\n\tif match == \"\" {\n\t\treturn model.ProjectOutput{}, errors.New(\"no valid project state JSON found in response\")\n\t}\n\n\tvar output model.ProjectOutput\n\terr := json.Unmarshal([]byte(match), \u0026output)\n\treturn output, err\n}",
    "internal/ui/ui.go": "package ui\n\nimport (\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"goctx/internal/apply\"\n\t\"goctx/internal/builder\"\n\t\"goctx/internal/model\"\n\t\"os\"\n\t\"path/filepath\"\n\n\t\"github.com/gotk3/gotk3/gdk\"\n\t\"github.com/gotk3/gotk3/gtk\"\n)\n\nfunc Run() {\n\tgtk.Init(nil)\n\tapplyCSS()\n\n\twin, _ := gtk.WindowNew(gtk.WINDOW_TOPLEVEL)\n\twin.SetTitle(\"● GoCtx Editor\")\n\twin.SetDefaultSize(1200, 800)\n\n\thbox, _ := gtk.BoxNew(gtk.ORIENTATION_HORIZONTAL, 0)\n\tsidebar, _ := gtk.BoxNew(gtk.ORIENTATION_VERTICAL, 0)\n\tsidebar.SetSizeRequest(300, -1)\n\tsctx, _ := sidebar.GetStyleContext()\n\tsctx.AddClass(\"sidebar\")\n\n\tlabel(sidebar, \"EXPLORER: STASHES\")\n\tstashList, _ := gtk.ListBoxNew()\n\trefreshStashes(stashList)\n\tsidebar.PackStart(stashList, true, true, 0)\n\n\teditorBox, _ := gtk.BoxNew(gtk.ORIENTATION_VERTICAL, 0)\n\tbar, _ := gtk.BoxNew(gtk.ORIENTATION_HORIZONTAL, 10)\n\tbar.SetMarginTop(10)\n\tbar.SetMarginBottom(10)\n\tbar.SetMarginStart(10)\n\n\tbtnGen := newBtn(\"Build Context\")\n\tbtnAI := newBtn(\"Ask AI (Rod)\")\n\tbtnApply := newBtn(\"Apply Manual\")\n\n\tbar.PackStart(btnGen, false, false, 0)\n\tbar.PackStart(btnAI, false, false, 0)\n\tbar.PackStart(btnApply, false, false, 0)\n\n\teditorBox.PackStart(bar, false, false, 0)\n\n\tsw, _ := gtk.ScrolledWindowNew(nil, nil)\n\ttv, _ := gtk.TextViewNew()\n\ttv.SetLeftMargin(10)\n\tbuf, _ := tv.GetBuffer()\n\tsw.Add(tv)\n\teditorBox.PackStart(sw, true, true, 0)\n\n\tpromptEntry, _ := gtk.EntryNew()\n\tpromptEntry.SetPlaceholderText(\"Describe changes...\")\n\teditorBox.PackEnd(promptEntry, false, false, 10)\n\n\t// ACTIONS\n\tbtnGen.Connect(\"clicked\", func() {\n\t\tctx, _ := builder.BuildContext(\".\")\n\t\tjs, _ := json.MarshalIndent(ctx, \"\", \"  \")\n\t\tbuf.SetText(string(js))\n\t})\n\n\thbox.PackStart(sidebar, false, false, 0)\n\thbox.PackStart(editorBox, true, true, 0)\n\twin.Add(hbox)\n\twin.ShowAll()\n\tgtk.Main()\n}\n\nfunc refreshStashes(list *gtk.ListBox) {\n\tlist.GetChildren().Foreach(func(item interface{}) { list.Remove(item.(gtk.IWidget)) })\n\tfilepath.Walk(\".stashes\", func(path string, info os.FileInfo, err error) error {\n\t\tif err == nil \u0026\u0026 info.IsDir() \u0026\u0026 path != \".stashes\" \u0026\u0026 filepath.Dir(path) == \".stashes\" {\n\t\t\trow, _ := gtk.ListBoxRowNew()\n\t\t\thbox, _ := gtk.BoxNew(gtk.ORIENTATION_HORIZONTAL, 5)\n\t\t\tlbl, _ := gtk.LabelNew(filepath.Base(path))\n\t\t\tbtn := newBtn(\"Apply\")\n\t\t\tbtn.SetSizeRequest(60, 20)\n\t\t\thbox.PackStart(lbl, true, true, 5)\n\t\t\thbox.PackEnd(btn, false, false, 5)\n\t\t\trow.Add(hbox)\n\t\t\tlist.Add(row)\n\t\t}\n\t\treturn nil\n\t})\n\tlist.ShowAll()\n}\n\nfunc label(box *gtk.Box, text string) {\n\tl, _ := gtk.LabelNew(text)\n\tl.SetXAlign(0)\n\tl.SetMarginStart(10)\n\tsctx, _ := l.GetStyleContext()\n\tsctx.AddClass(\"header\")\n\tbox.PackStart(l, false, false, 5)\n}\n\nfunc newBtn(l string) *gtk.Button {\n\tb, _ := gtk.ButtonNewWithLabel(l)\n\treturn b\n}\n\nfunc applyCSS() {\n\tprovider, _ := gtk.CssProviderNew()\n\tprovider.LoadFromPath(\"assets/style.css\")\n\tscreen, _ := gdk.ScreenGetDefault()\n\tgtk.AddProviderForScreen(screen, provider, gtk.STYLE_PROVIDER_PRIORITY_APPLICATION)\n}\n"
  }
}