{
  "estimated_tokens": 5500,
  "project_tree": ".\ninternal\n  └── apply\n    └── apply.go\n  └── ui\n    └── ui.go\nmain.go\n",
  "files": {
    "internal/ui/ui.go": "package ui\n\nimport (\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"goctx/internal/apply\"\n\t\"goctx/internal/builder\"\n\t\"goctx/internal/model\"\n\t\"os\"\n\t\"path/filepath\"\n\n\t\"github.com/gotk3/gotk3/gdk\"\n\t\"github.com/gotk3/gotk3/gtk\"\n)\n\nfunc Run() {\n\tgtk.Init(nil)\n\tapplyCSS()\n\n\twin, _ := gtk.WindowNew(gtk.WINDOW_TOPLEVEL)\n\twin.SetTitle(\"GO-CTX :: PROJECT STATE MANAGER\")\n\twin.SetDefaultSize(1100, 700)\n\twin.Connect(\"destroy\", gtk.MainQuit)\n\n\tmainBox, _ := gtk.BoxNew(gtk.ORIENTATION_HORIZONTAL, 0)\n\tsidebar, _ := gtk.BoxNew(gtk.ORIENTATION_VERTICAL, 10)\n\tsidebar.SetSizeRequest(280, -1)\n\tsidebar.GetStyleContext().AddClass(\"sidebar\")\n\n\tstashLabel, _ := gtk.LabelNew(\"--- STASHES (Double-Click to Revert) ---\")\n\tstashList, _ := gtk.ListBoxNew()\n\trefreshStashes(stashList)\n\n\tsidebar.PackStart(stashLabel, false, false, 10)\n\tsidebar.PackStart(stashList, true, true, 0)\n\n\tbody, _ := gtk.BoxNew(gtk.ORIENTATION_VERTICAL, 10)\n\tbody.SetMarginStart(15)\n\tbody.SetMarginEnd(15)\n\n\theader, _ := gtk.LabelNew(\"PROJECT STATE CONTROL\")\n\tbody.PackStart(header, false, false, 10)\n\n\tactions, _ := gtk.BoxNew(gtk.ORIENTATION_HORIZONTAL, 10)\n\tbtnGen, _ := gtk.ButtonNewWithLabel(\"GENERATE PROMPT\")\n\tbtnApply, _ := gtk.ButtonNewWithLabel(\"APPLY CLIPBOARD\")\n\tactions.PackStart(btnGen, true, true, 0)\n\tactions.PackStart(btnApply, true, true, 0)\n\tbody.PackStart(actions, false, false, 5)\n\n\tsw, _ := gtk.ScrolledWindowNew(nil, nil)\n\ttv, _ := gtk.TextViewNew()\n\ttv.SetMonospace(true)\n\tbuf, _ := tv.GetBuffer()\n\tsw.Add(tv)\n\tbody.PackStart(sw, true, true, 0)\n\n\tbtnGen.Connect(\"clicked\", func() {\n\t\tout, _ := builder.BuildContext(\".\")\n\t\tjsonData, _ := json.MarshalIndent(out, \"\", \"  \")\n\t\tprompt := fmt.Sprintf(\"Instruction: Refer to the following JSON object as the \\\"project state\\\". Reconstruct or modify the files as requested and return a modified project state JSON object.\\n\\nPROJECT STATE:\\n%s\", string(jsonData))\n\t\tbuf.SetText(prompt)\n\t})\n\n\tbtnApply.Connect(\"clicked\", func() {\n\t\tcb, _ := gtk.ClipboardGet(gdk.SELECTION_CLIPBOARD)\n\t\ttext, err := cb.WaitForText()\n\t\tif err != nil || text == \"\" {\n\t\t\tbuf.SetText(\"ERROR: Clipboard is empty or contains no text.\")\n\t\t\treturn\n\t\t}\n\t\tvar input model.ProjectOutput\n\t\tif err := json.Unmarshal([]byte(text), \u0026input); err != nil {\n\t\t\tbuf.SetText(\"ERROR: Invalid JSON in clipboard\")\n\t\t\treturn\n\t\t}\n\t\tapply.ApplyPatch(\".\", input)\n\t\tbuf.SetText(\"SUCCESS: State applied. Files updated.\")\n\t\trefreshStashes(stashList)\n\t})\n\n\twin.Add(mainBox)\n\tmainBox.PackStart(sidebar, false, false, 0)\n\tmainBox.PackStart(body, true, true, 0)\n\twin.ShowAll()\n\tgtk.Main()\n}\n\nfunc refreshStashes(list *gtk.ListBox) {\n\tlist.GetChildren().Foreach(func(item interface{}) { list.Remove(item.(gtk.IWidget)) })\n\tfilepath.Walk(\".stashes\", func(path string, info os.FileInfo, err error) error {\n\t\tif err == nil \u0026\u0026 info.IsDir() \u0026\u0026 path != \".stashes\" \u0026\u0026 filepath.Dir(path) == \".stashes\" {\n\t\t\trow, _ := gtk.ListBoxRowNew()\n\t\t\tlbl, _ := gtk.LabelNew(filepath.Base(path))\n\t\t\trow.Add(lbl)\n\t\t\tlist.Add(row)\n\t\t}\n\t\treturn nil\n\t})\n\tlist.ShowAll()\n}\n\nfunc applyCSS() {\n\tprovider, _ := gtk.CssProviderNew()\n\tprovider.LoadFromPath(\"assets/style.css\")\n\tscreen, _ := gdk.ScreenGetDefault()\n\tgtk.AddProviderForScreen(screen, provider, gtk.STYLE_PROVIDER_PRIORITY_APPLICATION)\n}\n",
    "main.go": "package main\n\nimport (\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"os\"\n\t\"sort\"\n\t\"goctx/internal/apply\"\n\t\"goctx/internal/builder\"\n\t\"goctx/internal/model\"\n\t\"goctx/internal/ui\"\n)\n\nfunc main() {\n\tif len(os.Args) == 1 {\n\t\trunBuild()\n\t\treturn\n\t}\n\n\tswitch os.Args[1] {\n\tcase \"apply\":\n\t\trunApply()\n\tcase \"gui\":\n\t\tui.Run()\n\tcase \"back\", \"forward\":\n\t\tnavigateStash(os.Args[1])\n\tcase \"tidy\":\n\t\ttidyStashes()\n\tdefault:\n\t\tfmt.Println(\"Commands: apply, gui, back, forward, tidy\")\n\t}\n}\n\nfunc navigateStash(dir string) {\n\tstashes, _ := os.ReadDir(\".stashes\")\n\tvar list []string\n\tfor _, s := range stashes {\n\t\tif s.IsDir() { list = append(list, s.Name()) }\n\t}\n\tsort.Strings(list)\n\tif len(list) == 0 {\n\t\tfmt.Println(\"No stashes found.\"); return\n\t}\n\t// Simple toggle logic for demo: in a real app, track current in meta.json\n\tfmt.Printf(\"Stash found: %s. Use GUI to select specific version or implement index tracking.\\n\", list[len(list)-1])\n}\n\nfunc tidyStashes() {\n\tos.RemoveAll(\".stashes\")\n\tos.Mkdir(\".stashes\", 0755)\n\tfmt.Println(\"Stashes tidied.\")\n}\n\nfunc runBuild() {\n\toutput, _ := builder.BuildContext(\".\")\n\tjson.NewEncoder(os.Stdout).Encode(output)\n}\n\nfunc runApply() {\n\tvar input model.ProjectOutput\n\tjson.NewDecoder(os.Stdin).Decode(\u0026input)\n\tapply.ApplyPatch(\".\", input)\n\tfmt.Println(\"Done.\")\n}\n"
  }
}