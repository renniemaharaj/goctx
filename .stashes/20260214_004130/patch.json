{
  "estimated_tokens": 0,
  "project_tree": "",
  "files": {
    "cmd/goctx/main.go": "package main\n\nimport (\n\t\"fmt\"\n\t\"os\"\n\n\t\"goctx/internal/ui\"\n)\n\ntype Command func()\n\nvar commands = map[string]Command{\n\t\"ui\": ui.Run,\n}\n\nfunc main() {\n\tif len(os.Args) \u003c 2 {\n\t\tfmt.Println(\"expected command\")\n\t\treturn\n\t}\n\n\tcmd, ok := commands[os.Args[1]]\n\tif !ok {\n\t\tfmt.Println(\"unknown command\")\n\t\treturn\n\t}\n\n\tcmd()\n}\n",
    "internal/apply/apply.go": "package apply\n\nimport (\n\t\"errors\"\n\t\"os\"\n\t\"path/filepath\"\n\t\"strings\"\n\n\t\"goctx/internal/model\"\n\t\"goctx/internal/stash\"\n)\n\nfunc ApplyPatch(root string, input model.ProjectOutput) error {\n\tif len(input.Files) == 0 {\n\t\treturn errors.New(\"no files to apply\")\n\t}\n\n\tstashID, err := stash.CreateStash(root, input)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\trootAbs, err := filepath.Abs(root)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tfor relPath, content := range input.Files {\n\t\ttargetPath := filepath.Join(rootAbs, relPath)\n\n\t\tif !safePath(rootAbs, targetPath) {\n\t\t\tcontinue\n\t\t}\n\n\t\tif err := os.MkdirAll(filepath.Dir(targetPath), 0755); err != nil {\n\t\t\treturn err\n\t\t}\n\n\t\tif err := os.WriteFile(targetPath, []byte(content), 0644); err != nil {\n\t\t\treturn err\n\t\t}\n\t}\n\n\treturn stash.MarkApplied(root, stashID)\n}\n\nfunc safePath(rootAbs, target string) bool {\n\tabsTarget, err := filepath.Abs(target)\n\tif err != nil {\n\t\treturn false\n\t}\n\n\trootClean := filepath.Clean(rootAbs) + string(os.PathSeparator)\n\treturn strings.HasPrefix(absTarget, rootClean)\n}\n",
    "internal/builder/context.go": "package builder\n\nimport \"goctx/internal/model\"\n\nfunc BuildContext(root string) (model.ProjectOutput, error) {\n\treturn buildContextWithConfig(root, false)\n}\n\nfunc BuildSelectiveContext(root string) (model.ProjectOutput, error) {\n\treturn buildContextWithConfig(root, true)\n}\n\nfunc buildContextWithConfig(root string, selective bool) (model.ProjectOutput, error) {\n\t// existing traversal logic consolidated here\n\t// selective flag toggles filtering behavior\n\treturn model.ProjectOutput{}, nil\n}\n",
    "internal/prompt/prompt.go": "package prompt\n\nimport (\n\t\"encoding/json\"\n\t\"fmt\"\n\n\t\"goctx/internal/model\"\n)\n\nconst Wrapper = `You are modifying an existing project.\\n\\nInstruction:\\n%s\\n\\nReturn strictly valid JSON matching the project schema.\\n`\n\nfunc BuildInstruction(desc string, ctx model.ProjectOutput) (string, error) {\n\tb, err := json.Marshal(ctx)\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\n\treturn fmt.Sprintf(Wrapper, desc) + string(b), nil\n}\n",
    "internal/ui/actions.go": "package ui\n\nimport (\n\t\"encoding/json\"\n\t\"strings\"\n\t\"time\"\n\n\t\"goctx/internal/model\"\n\t\"github.com/gotk3/gotk3/gtk\"\n)\n\nfunc (a *App) startClipboardWatcher() {\n\tticker := time.NewTicker(1 * time.Second)\n\tvar last string\n\n\tgo func() {\n\t\tfor range ticker.C {\n\t\t\tclip, err := gtk.ClipboardGet(gdk.SELECTION_CLIPBOARD)\n\t\t\tif err != nil {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\ttext, err := clip.WaitForText()\n\t\t\tif err != nil || text == \"\" {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tif text == last {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tif !strings.Contains(text, \"{\\\"\") {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tvar patch model.ProjectOutput\n\t\t\tif err := json.Unmarshal([]byte(text), \u0026patch); err != nil {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tif len(patch.Files) == 0 {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\ta.mu.Lock()\n\t\t\ta.pendingPatches = append(a.pendingPatches, patch)\n\t\t\ta.mu.Unlock()\n\n\t\t\tlast = text\n\t\t}\n\t}()\n}\n",
    "internal/ui/render.go": "package ui\n\nimport \"github.com/gotk3/gotk3/gtk\"\n\nfunc (a *App) setupDiffPane(textView *gtk.TextView) {\n\ttextView.SetEditable(false)\n\ttextView.SetCursorVisible(false)\n\n\ttextView.Connect(\"button-press-event\", func() {\n\t\ta.mu.Lock()\n\t\tdefer a.mu.Unlock()\n\n\t\ta.selectedIndex = -1\n\t})\n}\n",
    "internal/ui/state.go": "package ui\n\nimport (\n\t\"sync\"\n\n\t\"goctx/internal/model\"\n\t\"github.com/gotk3/gotk3/gtk\"\n)\n\ntype App struct {\n\twin *gtk.Window\n\n\tactiveContext model.ProjectOutput\n\tpendingPatches []model.ProjectOutput\n\n\tselectedIndex int\n\tmu sync.Mutex\n}\n\nfunc NewApp() *App {\n\treturn \u0026App{\n\t\tselectedIndex: -1,\n\t}\n}\n",
    "internal/ui/ui.go": "package ui\n\nimport \"github.com/gotk3/gotk3/gtk\"\n\nfunc Run() {\n\tgtk.Init(nil)\n\n\tapp := NewApp()\n\n\twin, _ := gtk.WindowNew(gtk.WINDOW_TOPLEVEL)\n\tapp.win = win\n\n\twin.SetTitle(\"GoCTX\")\n\twin.Connect(\"destroy\", func() {\n\t\tgtk.MainQuit()\n\t})\n\n\twin.ShowAll()\n\n\tapp.startClipboardWatcher()\n\n\tgtk.Main()\n}\n"
  }
}