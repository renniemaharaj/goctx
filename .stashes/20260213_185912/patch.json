{
  "estimated_tokens": 8200,
  "project_tree": ".\ninternal\n  ‚îî‚îÄ‚îÄ browser\n    ‚îî‚îÄ‚îÄ browser.go\n    ‚îî‚îÄ‚îÄ automation.go\n  ‚îî‚îÄ‚îÄ ui\n    ‚îî‚îÄ‚îÄ ui.go\n",
  "files": {
    "internal/browser/automation.go": "package browser\n\nimport (\n\t\"encoding/json\"\n\t\"errors\"\n\t\"goctx/internal/model\"\n\t\"regexp\"\n\t\"time\"\n)\n\nfunc ProcessWithAI(prompt string) (model.ProjectOutput, error) {\n\tb := Get()\n\tpage := b.MustPage(\"https://aistudio.google.com/app/prompts/new\") // Direct to AI Studio\n\t\n\t// Note: Selectors here depend on the specific UI state\n\t// This assumes a standard content-editable or textarea\n\ttextarea := page.MustElement(\"textarea, [contenteditable=\"true\"]\").MustWaitVisible()\n\ttextarea.MustInput(prompt)\n\t\n\t// Simulate hitting CMD+Enter or clicking send\n\tpage.Keyboard.MustType(\"\\n\") \n\t\n\t// Wait for the AI to finish generating\n\ttime.Sleep(5 * time.Second)\n\t\n\tcontent := page.MustElement(\"body\").MustText()\n\treturn ExtractProjectState(content)\n}\n\nfunc ExtractProjectState(input string) (model.ProjectOutput, error) {\n\tre := regexp.MustCompile(`(?s)\\{.*\\\"project_tree\\\".*\\\"files\\\".*\\}`) \n\tmatch := re.FindString(input)\n\tif match == \"\" {\n\t\treturn model.ProjectOutput{}, errors.New(\"AI response did not contain a valid JSON project state\")\n\t}\n\n\tvar output model.ProjectOutput\n\terr := json.Unmarshal([]byte(match), \u0026output)\n\treturn output, err\n}",
    "internal/browser/browser.go": "package browser\n\nimport (\n\t\"github.com/go-rod/rod\"\n\t\"github.com/go-rod/rod/lib/launcher\"\n)\n\nvar singleton *rod.Browser\n\nfunc Get() *rod.Browser {\n\tif singleton == nil {\n\t\tl := launcher.New().Headless(false).MustLaunch()\n\t\tsingleton = rod.New().ControlURL(l).MustConnect()\n\t}\n\treturn singleton\n}",
    "internal/ui/ui.go": "package ui\n\nimport (\n\t\"encoding/json\"\n\t\"goctx/internal/apply\"\n\t\"goctx/internal/builder\"\n\t\"goctx/internal/browser\"\n\t\"goctx/internal/model\"\n\t\"github.com/gotk3/gotk3/gtk\"\n)\n\nfunc Run() {\n\tgtk.Init(nil)\n\tapplyCSS()\n\n\twin, _ := gtk.WindowNew(gtk.WINDOW_TOPLEVEL)\n\twin.SetTitle(\"‚óè GoCtx AI Orchestrator\")\n\twin.SetDefaultSize(1200, 850)\n\n\thbox, _ := gtk.BoxNew(gtk.ORIENTATION_HORIZONTAL, 0)\n\n\t// SIDEBAR\n\tsidebar, _ := gtk.BoxNew(gtk.ORIENTATION_VERTICAL, 0)\n\tsidebar.SetSizeRequest(280, -1)\n\tsidebar.GetStyleContext().AddClass(\"sidebar\")\n\tlabel(sidebar, \"HISTORY / STASHES\")\n\tstashList, _ := gtk.ListBoxNew()\n\trefreshStashes(stashList)\n\tsidebar.PackStart(stashList, true, true, 0)\n\n\t// MAIN CONTENT\n\tbody, _ := gtk.BoxNew(gtk.ORIENTATION_VERTICAL, 10)\n\tbody.SetMarginStart(20)\n\tbody.SetMarginEnd(20)\n\n\t// Editor View (JSON Output)\n\tsw, _ := gtk.ScrolledWindowNew(nil, nil)\n\ttv, _ := gtk.TextViewNew()\n\ttv.SetMonospace(true)\n\tbuf, _ := tv.GetBuffer()\n\tsw.Add(tv)\n\tbody.PackStart(sw, true, true, 0)\n\n\t// LARGE PROMPT AREA\n\tlabel(body, \"AI INSTRUCTIONS\")\n\tpromptView, _ := gtk.TextViewNew()\n\tpromptView.SetWrapMode(gtk.WRAP_WORD)\n\tpromptView.SetSizeRequest(-1, 120)\n\tpromptView.GetStyleContext().AddClass(\"input-area\")\n\tpBuf, _ := promptView.GetBuffer()\n\tbody.PackStart(promptView, false, false, 0)\n\n\t// BOTTOM ACTION ROW\n\tbtnBox, _ := gtk.BoxNew(gtk.ORIENTATION_HORIZONTAL, 10)\n\tbtnBuild := newBtn(\"Build Current Context\")\n\tbtnAI := newBtn(\"üöÄ SYNCHRONIZE WITH AI\")\n\tbtnAI.GetStyleContext().AddClass(\"suggested-action\")\n\t\n\tbtnBox.PackStart(btnBuild, true, true, 0)\n\tbtnBox.PackStart(btnAI, true, true, 0)\n\tbody.PackStart(btnBox, false, false, 20)\n\n\t// LOGIC\n\tbtnBuild.Connect(\"clicked\", func() {\n\t\tout, _ := builder.BuildContext(\".\")\n\t\tjsonData, _ := json.MarshalIndent(out, \"\", \"  \")\n\t\tbuf.SetText(string(jsonData))\n\t})\n\n\tbtnAI.Connect(\"clicked\", func() {\n\t\tstart, end := pBuf.GetBounds()\n\t\tinstruction, _ := pBuf.GetText(start, end, false)\n\t\t\n\t\tcurrCtx, _ := builder.BuildContext(\".\")\n\t\tctxJS, _ := json.Marshal(currCtx)\n\t\t\n\t\tfullPrompt := \"TASK: \" + instruction + \"\\n\\nPROJECT_STATE: \" + string(ctxJS)\n\t\tbuf.SetText(\"// Launching browser... waiting for AI response...\")\n\t\t\n\t\tgo func() {\n\t\t\tupdatedState, err := browser.ProcessWithAI(fullPrompt)\n\t\t\tgtk.FunctionsInMain(func() {\n\t\t\t\tif err != nil {\n\t\t\t\t\tbuf.SetText(\"// ERROR: \" + err.Error())\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tapply.ApplyPatch(\".\", updatedState)\n\t\t\t\trefreshStashes(stashList)\n\t\t\t\tbuf.SetText(\"// SUCCESS: Project updated via AI.\")\n\t\t\t})\n\t\t}()\n\t})\n\n\thbox.PackStart(sidebar, false, false, 0)\n\thbox.PackStart(body, true, true, 0)\n\twin.Add(hbox)\n\twin.ShowAll()\n\tgtk.Main()\n}\n\nfunc newBtn(l string) *gtk.Button {\n\tbtn, _ := gtk.ButtonNewWithLabel(l)\n\treturn btn\n}\n\nfunc label(box *gtk.Box, text string) {\n\tl, _ := gtk.LabelNew(text)\n\tl.SetXAlign(0)\n\tsctx, _ := l.GetStyleContext()\n\tsctx.AddClass(\"header\")\n\tbox.PackStart(l, false, false, 5)\n}\n"
  }
}